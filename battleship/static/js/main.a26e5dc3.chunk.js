(this.webpackJsonpbattleship=this.webpackJsonpbattleship||[]).push([[0],{17:function(n,t,e){},18:function(n,t,e){},20:function(n,t,e){"use strict";e.r(t);var o,r=e(2),a=e.n(r),i=e(10),c=e.n(i),l=(e(17),e(1)),u=e(4),d=e(5),f=e(12),s=e(11),m=e(7),h=(e(18),e(9));!function(n){n.None="none",n.Head="head",n.Body="body"}(o||(o={}));var v=10,b=O(v,v,{placement:o.None}),j=[[{placement:o.None},{placement:o.Head},{placement:o.None}],[{placement:o.Body},{placement:o.Body},{placement:o.Body}],[{placement:o.None},{placement:o.Body},{placement:o.None}],[{placement:o.Body},{placement:o.Body},{placement:o.Body}]],p=[[{bomb:!0}]];function O(n,t,e){return new Array(n).fill(null).map((function(n){return new Array(t).fill(k(e))}))}function y(n,t){return n.map((function(n,e){return n.map((function(n,o){return t(e,o,n)}))}))}function g(n,t,e){var o=t;return y(n,(function(n,t,r){o=e(n,t,r,o)})),o}function B(n){var t=w(n),e=O(t.ncol,t.nrow,{placement:o.None});return y(e,(function(o,r,a){e[o][r]=n[t.nrow-1-r][o]})),e}function w(n){return{nrow:n.length,ncol:n[0].length}}function k(n){return JSON.parse(JSON.stringify(n))}function x(n){return{choice:!0,datum:n}}function M(n){return{choice:!1,datum:n}}function P(n,t,e){return n.choice?t(n.datum):e(n.datum)}function N(n,t,e,r){t=k(t);for(var a=w(n),i=w(t),c=0;c<a.nrow;c++)for(var l=0;l<a.ncol;l++)if(n[c][l].placement!==o.None){var u=e+c,d=r+l;if(!(0<=u&&u<i.nrow&&0<=d&&d<i.ncol))return M("out of range");if(t[u][d].placement!==o.None)return M("overlap!");t[u][d].placement=n[c][l].placement}return x(t)}function H(n,t,e,o){t=k(t);for(var r=w(n),a=w(t),i=0;i<r.nrow;i++)for(var c=0;c<r.ncol;c++){var u=e+i,d=o+c;0<=u&&u<a.nrow&&0<=d&&d<a.ncol&&(t[u][d]=Object(l.a)(Object(l.a)({},t[u][d]),n[i][c]))}return t}function I(n){return Math.floor(Math.random()*n)}function C(n,t){for(var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b,o=n;o>0;o--)for(var r=!1;!r;){var a=Math.floor(4*Math.random());new Array(a).fill(null).forEach((function(n){t=B(t)}));var i=Math.floor(Math.random()*v),c=Math.floor(Math.random()*v);P(N(t,e,i,c),(function(n){r=!0,e=n}),(function(n){}))}return e}var S,A,E=function(n){return Array.from({length:n},(function(n,t){return t}))};function F(n){return!g(n,!1,(function(n,t,e,r){var a=!e.bomb&&e.placement===o.Head;return r||a}))}!function(n){n.Unknown="unknown",n.HitHead="head",n.HitBody="body",n.HitNone="none"}(S||(S={})),function(n){n.Invalid="Invalid",n.Must="Must",n.Maybe="Maybe"}(A||(A={}));var D=function(n,t){return Math.trunc(n/t)},J=function(n){return{x:D(D(n,4),10),y:(t=D(n,4),e=10,t%e),orientation:n%4};var t,e};var K=function(){function n(t,e){var r=this;Object(u.a)(this,n),this.totalItemCount=void 0,this.item=void 0,this.rotatedItems=void 0,this.knownBoard=b,this.validityOfPlacements=Array(400).fill(A.Maybe),this.placeItem=function(n,t){return N(r.rotatedItems[n.orientation],t,n.x,n.y)},this.mapMaybePlacements=function(n){return E(400).filter((function(n){return r.validityOfPlacements[n]===A.Maybe})).map(n)},this.initialzeKnowledge=function(){console.log("BEGIN",r.knownBoard),console.log(r.validityOfPlacements),r.mapMaybePlacements((function(n){P(r.placeItem(J(n),r.knownBoard),(function(n){}),(function(t){r.validityOfPlacements[n]=A.Invalid}))})),console.log("END",r.knownBoard),console.log(r.validityOfPlacements)},this.randomPlacementCombination=function(n){var t=r.mapMaybePlacements((function(n){return n}));return function(n,t){for(var e=[];t>0;t--){var o=void 0;do{o=I(n)}while(e.indexOf(o)>=0);e.push(o)}return e.sort()}(t.length,n).sort().map((function(n){return J(t[n])}))},this.updateKnowledge=function(n){y(n,(function(n,t,e){if(e===S.HitHead&&r.knownBoard[n][t].placement!==o.Head){var a=E(400).filter((function(e){if(r.validityOfPlacements[e]!==A.Maybe)return!1;var a=J(e);return P(r.placeItem(a,r.knownBoard),(function(e){return e[n][t].placement===o.Head}),(function(n){return!1}))}));if(1===a.length){var i=a[0];P(r.placeItem(J(i),r.knownBoard),(function(n){r.validityOfPlacements[i]=A.Must,r.knownBoard=n}),(function(n){throw"Internal Error (374)!"}))}else console.log("candidatePlacements",a,a.map(J))}})),r.mapMaybePlacements((function(t){var e=J(t);P(r.placeItem(e,r.knownBoard),(function(a){var i;i=a,g(n,!0,(function(n,t,e,r){var a;return a=e!==S.HitNone||!(i[n][t].placement!==o.None),r&&a}))||(console.log("Disable 1",t,e),r.validityOfPlacements[t]=A.Invalid)}),(function(n){console.log("Disable 2",t,e),r.validityOfPlacements[t]=A.Invalid}))}))},this.guessBoards=function(n){var t,e=[],a=E(400).filter((function(n){return r.validityOfPlacements[n]===A.Must})).length,i=Object(h.a)(E(1200));try{for(i.s();!(t=i.n()).done;){t.value;P(r.randomPlacementCombination(r.totalItemCount-a).reduce((function(n,t){return e=function(n){return r.placeItem(t,n)},P(n,(function(n){return e(n)}),(function(n){return M(n)}));var e}),x(r.knownBoard)),(function(t){var r;r=t,g(n,!0,(function(n,t,e,a){var i;return i=e===S.HitBody?r[n][t].placement===o.Body:e===S.HitHead?r[n][t].placement===o.Head:e!==S.HitNone||r[n][t].placement===o.None,a&&i}))&&e.push(t)}),(function(n){}))}}catch(c){i.e(c)}finally{i.f()}return e},this.totalItemCount=t,this.item=e,this.rotatedItems=[];for(var a=0;a<4;a++)this.rotatedItems.push(this.item),this.item=B(this.item);this.initialzeKnowledge()}return Object(d.a)(n,[{key:"nextStep",value:function(n){console.log("knownBoard",this.knownBoard),console.log("validityOfPlacements",this.validityOfPlacements),this.updateKnowledge(n);var t,e=this.guessBoards(n),r=w(n),a=O(r.nrow,r.ncol,0),i=Object(h.a)(e);try{for(i.s();!(t=i.n()).done;){y(t.value,(function(t,e,r){r.placement===o.Head&&n[t][e]===S.Unknown&&(a[t][e]+=1)}))}}catch(u){i.e(u)}finally{i.f()}var c=g(a,0,(function(n,t,e,o){return Math.max(e,o)})),l=[];return y(a,(function(n,t,e){e===c&&l.push({i:n,j:t})})),console.log("max count",c),console.log(l),l[I(l.length)]}}]),n}(),U=e(0);function z(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(n,t){},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(n,t){};return Object(U.jsx)("div",{className:"Board",children:Object(U.jsx)("table",{children:Object(U.jsx)("tbody",{children:Object(U.jsx)(U.Fragment,{children:[null].concat(Object(m.a)(n)).map((function(o,r){return Object(U.jsx)("tr",{children:Object(U.jsx)(U.Fragment,{children:null===o?[null].concat(Object(m.a)(E(n[0].length))).map((function(n,t){return null===n?Object(U.jsx)("td",{}):Object(U.jsx)("td",{children:t})})):[null].concat(Object(m.a)(o)).map((function(n,o){return null===n?Object(U.jsx)("td",{children:String.fromCharCode("A".charCodeAt(0)+r-1)}):Object(U.jsx)("td",{className:"airplane-"+n.placement+(n.overlay?" overlay":"")+(n.bomb?" bomb":""),onClick:function(){return t(r-1,o-1)},onMouseEnter:function(){return e(r-1,o-1)},children:" "})}))})})}))})})})})}var L=function(n){Object(f.a)(e,n);var t=Object(s.a)(e);function e(n){var o;return Object(u.a)(this,e),(o=t.call(this,n)).state=o.initState(),o}return Object(d.a)(e,[{key:"initState",value:function(){return{kind:"setup",global:b,item:j,count:3,totalCount:3,hover:void 0}}},{key:"render",value:function(){var n=this,t=this.state;if("setup"===t.kind){var e=t.global;return t.hover&&(e=function(n,e){var r=w(t.item);return n-=Math.floor(r.nrow/2),e-=Math.floor(r.ncol/2),H(y(t.item,(function(n,t,e){return e.placement===o.Head||e.placement===o.Body?{overlay:!0}:{overlay:!1}})),t.global,n,e)}(t.hover.i,t.hover.j)),Object(U.jsxs)("div",{children:[z(e,(function(e,o){if(t.count>0){var r=w(t.item);e-=Math.floor(r.nrow/2),o-=Math.floor(r.ncol/2),P(N(t.item,t.global,e,o),(function(e){return n.setState(Object(l.a)(Object(l.a)({},t),{},{global:e,count:t.count-1}))}),(function(n){}))}}),(function(e,o){n.setState(Object(l.a)(Object(l.a)({},t),{},{hover:{i:e,j:o}}))})),Object(U.jsxs)("div",{onClick:function(){n.setState(Object(l.a)(Object(l.a)({},t),{},{item:B(t.item)}))},children:[z(t.item)," \xd7 ",t.count]}),Object(U.jsx)("button",{disabled:t.count>0,onClick:function(e){n.setState(Object(l.a)(Object(l.a)({},t),{},{kind:"fighting",ourBoard:t.global,theirBoard:C(t.totalCount,t.item),theirPlayer:new K(t.totalCount,t.item)}))},children:"Start"})]})}if("fighting"===t.kind){var r=function(e,r){if(!t.theirBoard[e][r].bomb){var a=H(p,t.theirBoard,e,r);if(F(a))n.setState(Object(l.a)(Object(l.a)({},t),{},{theirBoard:a,kind:"end",winner:"us"}));else{var i=t.theirPlayer.nextStep(function(n){return y(n,(function(n,t,e){return e.bomb?e.placement===o.Head?S.HitHead:e.placement===o.Body?S.HitBody:S.HitNone:S.Unknown}))}(t.ourBoard)),c=i.i,u=i.j,d=H(p,t.ourBoard,c,u);F(d)?n.setState(Object(l.a)(Object(l.a)({},t),{},{theirBoard:a,ourBoard:d,kind:"end",winner:"them"})):n.setState(Object(l.a)(Object(l.a)({},t),{},{theirBoard:a,ourBoard:d}))}}};return Object(U.jsxs)("div",{className:"main",children:[Object(U.jsxs)("div",{className:"left",children:[z(t.ourBoard),Object(U.jsx)("div",{children:"-----------------------"}),Object(U.jsx)("div",{className:"their",children:z(t.theirBoard,(function(n,t){return r(n,t)}))})]}),Object(U.jsxs)("div",{className:"right",children:[z(t.theirPlayer.knownBoard),Object(U.jsx)(U.Fragment,{children:t.theirPlayer.mapMaybePlacements((function(n){return z(P(t.theirPlayer.placeItem(J(n),b),(function(n){return n}),(function(n){throw"Error!"})))}))})]})]})}if("end"===t.kind){var a={us:"You won!",them:"You lost!"}[t.winner];return Object(U.jsxs)("div",{children:[a,Object(U.jsx)("button",{onClick:function(t){return n.setState(n.initState())},children:"Restart"}),z(t.ourBoard),Object(U.jsx)("div",{children:"-----------------------"}),z(t.theirBoard)]})}}}]),e}(a.a.Component);var T=function(n){n&&n instanceof Function&&e.e(3).then(e.bind(null,21)).then((function(t){var e=t.getCLS,o=t.getFID,r=t.getFCP,a=t.getLCP,i=t.getTTFB;e(n),o(n),r(n),a(n),i(n)}))};c.a.render(Object(U.jsx)(a.a.StrictMode,{children:Object(U.jsx)(L,{})}),document.getElementById("root")),T()}},[[20,1,2]]]);
//# sourceMappingURL=main.a26e5dc3.chunk.js.map